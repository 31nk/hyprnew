import"./shreddit-post-f0deec8f.js";import"./shreddit-post-flair-eebb2a74.js";import"./faceplate-progress-b01dd48c.js";import"./follow-button-b65055b8.js";import"./mod-note-overflow-menu-10dc7792.js";import"./achievements-entrypoint-0413e841.js";import"./reddit-chat-anchor-44ff0ab8.js";import{_ as t,h as e,n as s,f as i,x as a,s as o,A as r,cj as n,I as l,ds as d,i as c}from"./icon-ada4cc58.js";import{bH as p,dW as u,dU as m,dS as h,b0 as b,e4 as f,cZ as T,dV as S,al as j,dZ as C,d as g,d_ as y,dX as v,t as M,b as A,_ as x,ch as I}from"./shell-9a3ad68e.js";import{B as E}from"./base-translator-1f59220f.js";import"./translation-feedback-modal-6590da6d.js";import"./shreddit-post-translator-f1912ba0.js";import"./pdp-back-button-b14b2b0c.js";import{a as k}from"./ama-859a7489.js";import{p as P}from"./pluralize-b19aff3b.js";import"./faceplate-timeago-c21dd98e.js";import"./faceplate-date-ea2beded.js";import"./locale-e49f0b05.js";import"./faceplate-number-46bcc98c.js";import"./number-ea0536b9.js";import"./cached-intl-e5b35306.js";import"./index-cc61070e.js";import"./content-action-button-d17c08ad.js";import"./award-controller-29598592.js";import"./award-1b928347.js";import"./awardsTelemetryState-2c2d49a7.js";import"./utils-75a02ea9.js";import"./rpl-tooltip-6ff0c4c3.js";import"./contains-1042b204.js";import"./sleep-a1fd43c3.js";import"./content-tags-241fdcb4.js";import"./postUpdate-2d784242.js";import"./modActions-32f7f996.js";import"./shreddit-post-share-button-fd82e22b.js";import"./list-item-92483316.js";import"./with-share-4fce4a12.js";import"./a-459e5e7b.js";import"./index-6b6f75e3.js";import"./mod-actions-controller-8e16e7f6.js";import"./custom-event-8a5c1c61.js";import"./add-removal-reason-modal-17a54e0c.js";import"./modActions-86176a37.js";import"./keyed-b6c942f1.js";import"./faceplate-form-cfb6343e.js";import"./form-common-utils-4dba185c.js";import"./comment-f86d3e04.js";import"./post-edb43578.js";import"./post-69fe4f77.js";import"./faceplate-input-6aaf6007.js";import"./input-element-7c19d628.js";import"./dropdownButton-4fb00ad8.js";import"./faceplate-dropdown-menu-f53b9d9c.js";import"./popper-controller-2f3aa0ff.js";import"./makeEventDispatcher-28989282.js";import"./faceplate-menu-255c99e7.js";import"./faceplate-modal-71a626e6.js";import"./faceplate-textarea-input-ced9fd8a.js";import"./live-f7f79f15.js";import"./text-input-8201e088.js";import"./constants-abdf2fa9.js";import"./remove-highlighted-post-960b6aab.js";import"./utils-147dae00.js";import"./pdp-b6746f62.js";import"./throttle-cde4a556.js";import"./faceplate-shimmer-72ab8c98.js";import"./click-card-8df0732f.js";import"./faceplate-hovercard-26cd8885.js";import"./faceplate-tooltip-c7716df6.js";import"./outbound-link-tracking-controller-123a8b1b.js";import"./promote-post-button-12953a09.js";import"./utils-4ebdfa54.js";import"./events-82e64833.js";import"./overflow-menu-actions-24944b9f.js";import"./shreddit-overflow-report-9e45ec2d.js";import"./v2-events-93dbc90c.js";import"./index-db69119e.js";import"./lexical-1c245d48.js";import"./display-theme-7e251d41.js";import"./rtjson-d7db35d6.js";import"./classnameUtils-e77f7123.js";import"./mod-verdict-dcb43309.js";import"./faceplate-carousel-clone-87fd24a1.js";import"./faceplate-pagination-indicator-13acc010.js";import"./TinyGesture-6f7cc1aa.js";import"./index-b5439860.js";import"./translations-8f2d7cb9.js";import"./faceplate-bottom-sheet-fe8741d1.js";import"./faceplate-banner-badc049e.js";import"./relative-date-77173042.js";const q={TITLE:"title",TEXT_BODY:"text-body",TRANSLATION_SUFFIX:"-translated",TRANSLATION_ERROR:"#post-translation-error",STILL_IMAGE:`.${v}`,MEDIA_URL:"#media-url",MEDIA_FULLSIZE_URL:"#media-fullsize-url",SRC_SET:"#src-set",ZOOMABLE_IMG:"zoomable-img"};let D=class extends E{constructor(){super(),this.translatorChildrenName="shreddit-post",this.seoVisitSettled=!1,this.isSeoVisit=!1,this.translationState={originalMediaSrcset:"",originalMediaUrl:"",originalMediaFullsizeUrl:"",translatedMediaUrl:"",translatedMediaSrcset:"",translatedMediaFullsizeUrl:""},this._partialRequest=new p(this)}connectedCallback(){super.connectedCallback();const t=this.querySelector(this.translatorChildrenName);t&&this.translationContextValue.isTranslationActive&&t.isPostTranslated&&this.trackEvent(this,u(t,!0)),this.addEventListener(m,this.handleTranslationFeedback)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}handleTranslationFeedback(t){const e=this.translationContextValue.isTranslationActive,s=this.querySelector(this.translatorChildrenName),i=s?.id,a=s?.querySelector(e?'[slot="title-translated"]':'[slot="title"]'),o=s?.querySelector(e?'[slot="text-body-translated"]':'[slot="text-body"]'),r=this.shadowRoot?.getElementById(h.ID.PDP_POST_FEEDBACK_MODAL);r&&r.show?.({post:{id:i,title:a?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:e}})}async onTranslationsEnabled(){this.togglePostTranslations(!0),this.submitTranslationMetrics()}async onTranslationsDisabled(){this.togglePostTranslations(!1),this.submitTranslationMetrics()}async togglePostTranslations(t){const e=this.findTranslatablePost(t);if(!e)return this.logError({error:"post not found"});if(e.isTranslationFetched)return this.trackEvent(this,u(e,t)),this.toggleMediaTranslation(t),void(e.isPostTranslated=t);if(!e.isTranslatable&&e.postType!==b.Image)return;const s=await this.loadPostTranslations(e,t);if(!(s&&!1===s.includes?.(f)))return this.logError({error:"api error",metadata:{id:e.id,isTranslationActive:t}});e.isTranslatable&&this.trackEvent(this,u(e,t));const i=T(s);this.appendResponseToPost(e,i),this.storeMediaResponseToCache(i,t),this.toggleMediaTranslation(t)}findTranslatablePost(t){const e=this.querySelector(this.translatorChildrenName);if(!(!e||e.isPostTranslated&&t))return e}async loadPostTranslations(t,e){if(t.isTranslatable||t.postType===b.Image){const s=e?S.GetTranslation:S.GetOriginal,i=new FormData;i.append("postId",t.id),i.append("translationState",s),t.isTranslatable&&i.append("isTranslatable","true");const a="/svc/shreddit/translated-post/";return(await this._partialRequest.request(a,{method:j.Post,body:i}))?.text()}}appendResponseToPost(t,e){if(!t.isTranslatable)return;let s=!1;const i=t.isPostTranslated?[q.TITLE,q.TEXT_BODY]:[`${q.TITLE}${q.TRANSLATION_SUFFIX}`,`${q.TEXT_BODY}${q.TRANSLATION_SUFFIX}`];e.forEach((e=>{const a=e.getAttribute("slot")||"";a.includes(q.TEXT_BODY)&&this.isDevPlatformPost()||i.includes(a)&&!t.querySelector(`[slot="${a}"]`)&&(t.appendChild(e),s=!0)})),s&&(t.isTranslationFetched=!0,this.translationContextValue.isTranslationActive?(t.isPostTranslated=!0,t.isPostBodyTranslated=!0):(t.isPostTranslated=!1,t.isPostBodyTranslated=!1))}storeMediaResponseToCache(t,e){const s=document.querySelector(q.STILL_IMAGE),i=document.querySelector(q.ZOOMABLE_IMG)?.querySelector("img");let a,o,r;t.forEach((t=>{t.id===q.MEDIA_URL.slice(1)&&(a=t.textContent||""),t.id===q.SRC_SET.slice(1)&&(r=t.textContent||""),t.id===q.MEDIA_FULLSIZE_URL.slice(1)&&(o=t.textContent||"")})),a&&r&&(e?(this.translationState.originalMediaUrl=s?.getAttribute("src")||"",this.translationState.originalMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.originalMediaFullsizeUrl=i?.getAttribute("src")||"",this.translationState.translatedMediaUrl=a,this.translationState.translatedMediaSrcset=r,this.translationState.translatedMediaFullsizeUrl=o??""):(this.translationState.originalMediaUrl=a,this.translationState.originalMediaSrcset=r,this.translationState.originalMediaFullsizeUrl=o??"",this.translationState.translatedMediaUrl=s?.getAttribute("src")||"",this.translationState.translatedMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.translatedMediaFullsizeUrl=i?.getAttribute("src")||""))}toggleMediaTranslation(t){if(!this.isMediaCacheStored())return;const e=document.querySelector(q.STILL_IMAGE),s=document.querySelector(q.ZOOMABLE_IMG)?.querySelector("img");t?(e?.setAttribute("src",this.translationState.translatedMediaUrl),e?.setAttribute("srcset",this.translationState.translatedMediaSrcset),s?.setAttribute("src",this.translationState.translatedMediaFullsizeUrl)):(e?.setAttribute("src",this.translationState.originalMediaUrl),e?.setAttribute("srcset",this.translationState.originalMediaSrcset),s?.setAttribute("src",this.translationState.originalMediaFullsizeUrl))}isMediaCacheStored(){return!!this.translationState.translatedMediaUrl&&!!this.translationState.originalMediaUrl}isDevPlatformPost(){return null!==this.querySelector("shreddit-devvit-ui-loader")}submitTranslationMetrics(){if(!this.reportMetrics)return;const t=this.querySelector("shreddit-post");if(!t)return;const{id:e,postType:s="",isPostTranslated:i,isTranslatable:a,isPostBodyTranslated:o}=t,r=this.translationContextValue?.isTranslationActive||!1,n={},l=t.querySelector('[slot="title"')?.textContent||"",d=t.querySelector('[slot="title-translated"')?.textContent||"",c=t.querySelector('[slot="text-body"]')?.textContent||"",p=t.querySelector('[slot="text-body-translated"]')?.textContent||"",u=""!==c||""!==p;n.scenario=this.metricsScenario,n.targetLanguage=t.translationLanguage,n.post=C({postId:e,postType:s,translationSetting:r,originalTitle:l,translatedTitle:d,originalBody:c,translatedBody:p,isTitleTranslated:i,isBodyTranslated:u?o:i,isTranslatable:a}),this.dispatchEvent(g(y,n))}render(){return a`\n <div><slot></slot></div>\n <translation-feedback-modal \n id="${h.ID.PDP_POST_FEEDBACK_MODAL}" \n></translation-feedback-modal>\n `}};t([s({type:Boolean,attribute:"is-seo-visit"})],D.prototype,"isSeoVisit",void 0),t([e()],D.prototype,"translationState",void 0),D=t([i("post-translator")],D);let w=class extends o{constructor(){super(...arguments),this.isSetup=!1,this.hasPrevious=!1,this.hasNext=!1,this.feedData=[],this.currentIndex=-1,this.setup=()=>{const t=Array.from(document.querySelectorAll("[slot=mod-queue-feed] mod-queue-list-item, [slot=mod-queue-feed] shreddit-post, [slot=mod-queue-feed] shreddit-profile-comment")).map((t=>t.getAttribute("comment-id")||t.getAttribute("id"))).filter(Boolean);t.length>0&&(this.feedData=t,this.currentIndex=this.feedData.findIndex((t=>t===this.thingId)),this.hasPrevious=this.currentIndex>0,this.hasNext=this.currentIndex+1<this.feedData.length,this.isSetup=!0)},this.handlePreviousBtnClick=()=>{const t=this.feedData[this.currentIndex-1];document.querySelector(`[slot=mod-queue-feed] mod-queue-list-item[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-post[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-profile-comment[comment-id="${t}"] *`)?.click()},this.handleNextBtnClick=()=>{const t=this.feedData[this.currentIndex+1];document.querySelector(`[slot=mod-queue-feed] mod-queue-list-item[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-post[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-profile-comment[comment-id="${t}"] *`)?.click()}}connectedCallback(){super.connectedCallback(),this.setup()}render(){return this.isSetup?a`<div class="flex">\n ${A({appearance:"plain",attributes:{type:"button","aria-label":"Previous post",disabled:!this.hasPrevious,onclick:this.handlePreviousBtnClick},leadingIcon:n({size:l.Small}),size:x.Small})}\n ${A({appearance:"plain",attributes:{type:"button","data-label":"pdp-post-close","aria-label":"Next post",disabled:!this.hasNext,onclick:this.handleNextBtnClick},leadingIcon:d({size:l.Small}),size:x.Small})}\n </div>`:r}};w.styles=[M],t([s({type:String,attribute:"thing-id"})],w.prototype,"thingId",void 0),t([e()],w.prototype,"isSetup",void 0),t([e()],w.prototype,"hasPrevious",void 0),t([e()],w.prototype,"hasNext",void 0),t([e()],w.prototype,"feedData",void 0),t([e()],w.prototype,"currentIndex",void 0),w=t([i("mod-queue-pdp-pagination-buttons")],w);let _=class extends o{constructor(){super(...arguments),this.isVisible=!1,this.handleScroll=t=>{const e=t.target.scrollTop;this.isVisible=e>60}}connectedCallback(){super.connectedCallback();this.closest('[slot="pdp-panel"]')?.addEventListener("scroll",this.handleScroll)}disconnectedCallback(){super.disconnectedCallback();this.closest('[slot="pdp-panel"]')?.removeEventListener("scroll",this.handleScroll)}render(){return this.isVisible?a`<div \n class="bg-neutral-background z-[2] flex justify-end absolute right-md shadow-md p-2xs rounded-full mt-sm" \n>\n <slot name="pagination"></slot>\n <slot name="close"></slot>\n </div>`:r}};_.styles=[M],t([e()],_.prototype,"isVisible",void 0),_=t([i("mod-queue-pdp-floating-ctas")],_);let L=class extends o{constructor(){super(...arguments),this.isMobile=!1,this.showDurationS=8,this.postId="",this.isPillVisible=!1,this.hostCommentCount=0,this.isAddedTabEvent=!1,this.commentCountSubscriptionController=new I(this),this.onData=t=>{this.isAddedTabEvent||(document.querySelector(`.${k}`)?.addEventListener("click",this.handleAmaCommentTabClick),this.isAddedTabEvent=!0);const e=t.subscribe.data.hostCommentCountChange||0;e<=0||(this.hostCommentCount+=e,this.isPillVisible?clearTimeout(this.currentCountDown):this.isPillVisible=!0,this.currentCountDown=setTimeout((()=>{this.isPillVisible=!1}),1e3*this.showDurationS))},this.scrollToCommentsAndRefreshAnswers=()=>{const t=document.querySelector(`.${k}`)?.offsetTop;if(!t)return;const e=document.querySelector("nav")?.offsetHeight??0;window.scrollTo({top:t-e,behavior:"smooth"});document.querySelector('button[value="answered"]')?.click()},this.onPillClick=()=>{this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown),this.currentCountDown=void 0,this.scrollToCommentsAndRefreshAnswers()},this.handleAmaCommentTabClick=t=>{const e=t.target?.getAttribute("value"),s=e&&e.toLowerCase();"all"!==s&&"answered"!==s||(this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown))}}static get styles(){return[c`:host{left:50%;position:fixed;top:calc(var(--shreddit-header-height) + 32px);transform:translateX(-50%);z-index:1001}`,M]}getTitleText(){const t=this.hostCommentCount;return P({count:t,single:`${t} new answer`,many:`${t} new answers`})}connectedCallback(){super.connectedCallback(),this.commentCountSubscriptionController.subscribe({query:{operationName:"SubscribeSubscription",query:"\n          subscription SubscribeSubscription($input: SubscribeInput!) {\n            subscribe(input: $input) {\n              ... on BasicMessage {\n                data {\n                  ... on CommentCountUpdateMessageData {\n                    hostCommentCountChange\n                  }\n                }\n              }\n            }\n          }\n          ",variables:{input:{channel:{teamOwner:"CONTENT_AND_COMMUNITIES",category:"COMMENT_COUNT_UPDATE",postID:this.postId}}}},onData:t=>{t.data&&this.onData(t.data)}})}disconnectedCallback(){super.disconnectedCallback(),document.querySelector(`.${k}`)?.removeEventListener("click",this.handleAmaCommentTabClick)}render(){return this.isPillVisible?A({appearance:"primary",attributes:{onclick:this.onPillClick},children:this.getTitleText(),size:this.isMobile?x.Small:x.Large,role:"button"}):r}};t([s({type:Boolean,attribute:"is-mobile"})],L.prototype,"isMobile",void 0),t([s({type:Number,attribute:"show-duration-in-s"})],L.prototype,"showDurationS",void 0),t([s({type:String,attribute:"post-id"})],L.prototype,"postId",void 0),t([e()],L.prototype,"isPillVisible",void 0),t([e()],L.prototype,"hostCommentCount",void 0),L=t([i("ama-new-comment-pill")],L);
//# sourceMappingURL=pdp-post-client-js-93d5b52c.js.map
