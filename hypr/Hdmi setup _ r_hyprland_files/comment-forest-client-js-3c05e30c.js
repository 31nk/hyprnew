import{_ as t,s as e,n as s,f as n,x as i,h as o,F as a,I as r,i as l,w as c,ba as d,C as m,A as h,bI as p,dd as u}from"./icon-ada4cc58.js";import{W as b,cg as v,k as g,t as C,c as f,gA as y,q as S,gB as w,h as _,a as k,cM as T,br as x,aP as j,cZ as A,b9 as I,bP as E,b as P,_ as O,aU as L,l as D,bH as V,fw as M,gC as $,gD as q,al as B,dS as U,gE as R,d as F,gF as N,di as z,dj as H,f as Q,gG as J,gH as K,B as W,gI as G,gJ as Z,bz as X,a8 as Y,gK as tt,o as et,dk as st,de as nt,dl as it}from"./shell-9a3ad68e.js";import{C as ot,o as at}from"./shreddit-comment-de914d78.js";import{t as rt}from"./throttle-cde4a556.js";import{d as lt,R as ct}from"./shreddit-overflow-report-9e45ec2d.js";import{S as dt}from"./scroll-blocker-7d6d8f9d.js";import{t as mt}from"./comments-00c68d93.js";import"./shreddit-spoiler-7fc485fc.js";import"./faceplate-render-0cbcd8de.js";import"./author-flair-event-handler-b131cbb2.js";import{B as ht}from"./base-translator-1f59220f.js";import"./translation-feedback-modal-6590da6d.js";import{g as pt}from"./post-edb43578.js";import"./shreddit-comment-badges-cc5799a0.js";import"./mod-notes-opener-3abc9833.js";import{R as ut}from"./pdp-comment-search-close-26d784b0.js";import{s as bt,S as vt}from"./search-params-30742d8f.js";import{S as gt,a as Ct,b as ft}from"./search-dynamic-id-988556cd.js";import"./reddit-feed-dee8d05b.js";import"./faceplate-search-input-b325c518.js";import"./faceplate-tooltip-c7716df6.js";import"./adjust-search-query-link-060571fe.js";import"./search-dynamic-id-cache-controller-6d390c4f.js";import"./translation-contribution-toggle-9cfee2c9.js";import"./rpl-dialog-trigger-dbb2b7c3.js";import"./rpl-bottom-sheet-818494f2.js";import"./faceplate-number-46bcc98c.js";import"./locale-e49f0b05.js";import"./number-ea0536b9.js";import"./cached-intl-e5b35306.js";import"./faceplate-timeago-c21dd98e.js";import"./relative-date-77173042.js";import"./award-controller-29598592.js";import"./mention-node-8b3fb963.js";import"./lexical-1c245d48.js";import"./upload-aea4e6c7.js";import"./upload-to-s3-e3788e37.js";import"./comment-composer-host-1dfb7e87.js";import"./rte-toolbar-button-emote-c9be9539.js";import"./faceplate-dropdown-menu-f53b9d9c.js";import"./popper-controller-2f3aa0ff.js";import"./makeEventDispatcher-28989282.js";import"./postComposerFields-17ca5a70.js";import"./translations-8f2d7cb9.js";import"./faceplate-checkbox-input-1ba9067c.js";import"./checked-input-element-00610e5f.js";import"./faceplate-input-6aaf6007.js";import"./input-element-7c19d628.js";import"./form-common-utils-4dba185c.js";import"./constants-abdf2fa9.js";import"./faceplate-modal-71a626e6.js";import"./automation-rule-triggered-rules-25e055e3.js";import"./filterNullish-14d2de97.js";import"./avatar-62ca4ecf.js";import"./rtjson-d7db35d6.js";import"./dom-37d48515.js";import"./reputation-recaptcha-f5c28624.js";import"./comment-f86d3e04.js";import"./modActions-32f7f996.js";import"./sleep-a1fd43c3.js";import"./faceplate-progress-b01dd48c.js";import"./telemetry-event-struct-fef69997.js";import"./outbound-link-tracking-controller-123a8b1b.js";import"./classnameUtils-e77f7123.js";import"./common-ui-strings-65954718.js";import"./faceplate-textarea-input-ced9fd8a.js";import"./live-f7f79f15.js";import"./text-input-8201e088.js";import"./faceplate-bottom-sheet-fe8741d1.js";import"./TinyGesture-6f7cc1aa.js";import"./post-69fe4f77.js";import"./distinguished-tags-02527156.js";import"./mod-notes-aa28f423.js";import"./faceplate-text-input-b744c6ca.js";import"./faceplate-switch-input-39a16472.js";import"./contains-1042b204.js";const yt=b(e);let St=class extends yt{constructor(){super(...arguments),this.commentId="",this.parentCommentPermalink="",this.postPermalink="",this.isInModQueue=!1,this.onLinkClick=(t,e)=>{this.isInModQueue&&(t.stopPropagation(),t.preventDefault(),v?.(g.ModQueuePdpLinkClick,{isFullDiscussionLink:e,parentCommentPermalink:this.parentCommentPermalink,postPermalink:this.postPermalink}))}}static get styles(){return[C,f(".single-comment-thread-toolbar {\n  align-items: center;\n  display: flex;\n  flex-flow: row nowrap;\n  font: var(--font-title-h6);\n  justify-content: space-between;\n  padding: 0.5rem 1rem;\n}\n")]}firstUpdated(){this.updateComplete.then((()=>{if(this.isInModQueue)return;const t=this.getBoundingClientRect().top;window.scrollTo({top:t-48,behavior:"auto"})}))}handleSeeFullDiscussionLink(t){this.onLinkClick(t,!0);const e=document.querySelector("shreddit-post");e&&this.trackEvent(y(e))}render(){if(!this.commentId)return;const t=this.isInModQueue?"View parent comment":"Single comment thread",e="no-underline hover:no-underline visited:no-underline text-primary";return i`\n <div>\n <div class="single-comment-thread-toolbar text-neutral-content-weak">\n ${this.parentCommentPermalink?i`\n <a \n href="${this.parentCommentPermalink}" \n class="${e}" \n @click="${this.onLinkClick}" \n>\n ${t}\n </a>\n `:i` <span>${t}</span> `}\n <span class="flex-1 h-px mx-xs bg-tone-4" data-id="line"></span>\n <a \n href="${this.postPermalink}" \n class="${e}" \n @click="${this.handleSeeFullDiscussionLink}" \n>\n See full discussion\n </a>\n </div>\n </div>\n `}};t([s({type:String,attribute:"comment-id"})],St.prototype,"commentId",void 0),t([s({type:String,attribute:"parent-comment-permalink"})],St.prototype,"parentCommentPermalink",void 0),t([s({type:String,attribute:"post-permalink"})],St.prototype,"postPermalink",void 0),t([s({type:Boolean,attribute:"is-in-modqueue"})],St.prototype,"isInModQueue",void 0),St=t([n("shreddit-comments-page-tools")],St);const wt=S(e);let _t=class extends wt{constructor(){super(...arguments),this.isVisible=!1}connectedCallback(){super.connectedCallback(),this.enableObserver({threshold:1})}disconnectedCallback(){super.disconnectedCallback(),this.disableObserver()}publishEvent(){v(g.TriggerCommentBlockingAuth,{source:ot.Scroll}),this.disableObserver()}observerIsIntersectingCallback(){this.isVisible||(this.publishEvent(),this.isVisible=!0)}render(){return i`<div></div> `}};_t=t([n("cbau-trigger")],_t);const kt=b(k(e));let Tt=class extends kt{constructor(){super(...arguments),this.thingId="",this.postId="",this.subredditPrefixedName="",this.isTruncated=!1,this.totalComments=0,this.isProfilePost=!1,this.isReportingEnabled=!1,this.ui="mobile",this.permalink="",this.author="",this.isAuthorDeleted=!1,this.pageUnloaded=!1,this.initialViewStats={num_comments_viewed:0,comments_viewed_json:[],comments_viewed_list:[],num_comments_consumed:0,comments_consumed_json:[],comments_consumed_list:[]},this.view_stats=this.cloneObject(this.initialViewStats),this.correlation_id=T(),this.page_request_id=x(),this.overflowActionsMenuRef=j(),this.scrollBlocker=new dt(this),this._visibilityDetails=null,this.depthUpdated=null,this.handleVisibilityChange=t=>{t?(this.pageUnloaded=!1,this.resetViewStats()):this.pageUnloaded||this.flushEvents()},this.onBeforeUnload=()=>{this.pageUnloaded=!0,this.flushEvents()},this.flushEvents=()=>{const t=((t,e,s,n,i,o)=>{let a={};const r=w("post"),l=e.slice(0,1e3);return a={correlation_id:i,view_stats:{num_comments_viewed:t,comments_viewed_json:JSON.stringify(l),comments_viewed_list:s},post:{...r,number_comments:n},action_info:{page_request_id:o}},_({source:"post",action:"view",noun:"comments"},a)})(this.view_stats.num_comments_viewed,this.view_stats.comments_viewed_json,this.view_stats.comments_viewed_list,this.totalComments,this.correlation_id,this.page_request_id),e=((t,e,s,n,i,o)=>{let a={};const r=w("post"),l=e.slice(0,1e3);return a={correlation_id:i,view_stats:{num_comments_consumed:t,comments_consumed_json:JSON.stringify(l),comments_consumed_list:s},post:{...r,number_comments:n},screen:{height:window?.screen.height,width:window?.screen.width},action_info:{page_request_id:o}},_({source:"post",action:"consume",noun:"comments"},a)})(this.view_stats.num_comments_consumed,this.view_stats.comments_consumed_json,this.view_stats.comments_consumed_list,this.totalComments,this.correlation_id,this.page_request_id);this.trackEvent(t),this.trackEvent(e),this.resetViewStats()},this.commentsViewedListener=t=>{this.updateCommentsViewedStats(t.detail)},this.commentsConsumedListener=t=>{this.updateCommentsConsumedStats(t.detail)},this.handleCloseOverflowActionsMenu=()=>{this.overflowActionsMenuRef.value?.close(),document.documentElement.removeEventListener("click",this.handleCloseOverflowActionsMenu),this.scrollBlocker.unblockPageScrolling()},this.handleCommentCreated=({parentThingId:t,body:e})=>{this.postId===t&&e&&(this.querySelector("#next-comment")?.after(...A(e)),this.totalComments+=1)}}static get styles(){return[C,f(":host {\n  display: block;\n  background-color: var(--shreddit-content-background);\n  padding-bottom: var(--spacer-xs);\n}\n"),f(lt)]}get visibilityDetails(){return null===this._visibilityDetails&&null===this.depthUpdated&&(this.depthUpdated=new Promise((t=>{requestAnimationFrame((()=>{const e=this.getVisibilityDetails();this._visibilityDetails=e,t(e)}))}))),this._visibilityDetails}getVisibilityDetails({containerWidth:t}={}){const e=this.querySelector(":scope > shreddit-comment")?.depth??0;t??(t=this.getBoundingClientRect().width);const s="mobile"===this.ui?232:320,n="mobile"===this.ui?18:32,i="mobile"===this.ui?4:10,o=Math.floor((t-s)/n),a=Math.max(1,Math.min(o,i)),r=a+e,l=this.querySelector(":scope shreddit-comment[is-chosen-mq-comment]"),c=l?.depth??0,d=Math.max(e,c-a+1);return l?{maxVisibleDepth:d+a,minVisibleDepth:d}:{maxVisibleDepth:r}}cloneObject(t){return JSON.parse(JSON.stringify(t))}connectedCallback(){super.connectedCallback(),this.addEventListener(at,this.handleOpenOverflowActionsMenu),this.subscribe(g.CommentCreated,this.handleCommentCreated),this.resizeObserver=new ResizeObserver(rt((t=>{let e=0;for(const s of t){const t=s.contentBoxSize.at(0)?.inlineSize;if(t){e=t;break}}if(0===e)return;const s=this.getVisibilityDetails({containerWidth:e});if(this._visibilityDetails?.maxVisibleDepth!==s.maxVisibleDepth||this._visibilityDetails?.minVisibleDepth!==s.minVisibleDepth){this._visibilityDetails=s,this.depthUpdated=Promise.resolve(s);for(const t of this.querySelectorAll("shreddit-comment"))t.setVisibility(s.maxVisibleDepth,s.minVisibleDepth)}}),128,!0)),this.resizeObserver.observe(this,{box:"content-box"}),this.addEventListener("comments-viewed-event",this.commentsViewedListener),this.addEventListener("comments-consumed-event",this.commentsConsumedListener),I.subscribe(this.onBeforeUnload,{unloadOnly:!0}),E(this.handleVisibilityChange,{immediate:!0}),window.addEventListener("beforeRoute",(()=>{this.flushEvents()}))}resetViewStats(){this.correlation_id=T(),this.view_stats=this.cloneObject(this.initialViewStats)}updateCommentsViewedStats(t){return this.view_stats.comments_viewed_json.find((e=>e.comment_id===t?.detail.comment_id))||(this.view_stats.comments_viewed_json.push({comment_depth:t?.detail.comment_depth,comment_id:t?.detail.comment_id,comment_parent_id:t?.detail.comment_parent_id}),this.view_stats.comments_viewed_list.push(t?.detail.comment_id),this.view_stats.num_comments_viewed=this.view_stats.comments_viewed_json.length),t}updateCommentsConsumedStats(t){return this.view_stats.comments_consumed_json.find((e=>e.comment_id===t?.detail.comment_id))||(this.view_stats.comments_consumed_json.push({comment_depth:t?.detail.comment_depth,comment_id:t?.detail.comment_id,comment_parent_id:t?.detail.comment_parent_id}),this.view_stats.comments_consumed_list.push(t?.detail.comment_id),this.view_stats.num_comments_consumed=this.view_stats.comments_consumed_json.length),t}disconnectedCallback(){super.disconnectedCallback(),I.unsubscribe(this.onBeforeUnload),this.removeEventListener(at,this.handleOpenOverflowActionsMenu),this.unsubscribe(g.CommentCreated,this.handleCommentCreated),this.resizeObserver?.unobserve(this),this.resizeObserver?.disconnect(),this.removeEventListener("comments-viewed-event",this.commentsViewedListener),this.removeEventListener("comments-consumed-event",this.commentsConsumedListener)}showAllComments(){this.publish(g.TriggerCommentBlockingAuth,{source:ot.Button}),this.isTruncated=!1,this.trackEvent(mt())}renderShredtopViewMoreCommentsButton(t){return P({attributes:{type:"button",className:"ml-sm xs:ml-0 font-semibold mt-md",onclick:t},appearance:"brand",shape:"pill",leadingIcon:a({size:r.Medium}),size:O.Small,children:"View more comments"})}renderTruncatedExpandButton(){return this.renderShredtopViewMoreCommentsButton(this.showAllComments)}renderContent(){const t="Comments Section";return i`\n <section \n class="flex flex-col px-md xs:px-0 gap-md relative" \n aria-label="Comments" \n>\n <h1 \n class="absolute -top-full -left-full w-px h-px overflow-hidden" \n aria-label="${t}" \n>\n ${t}\n </h1>\n <slot></slot>\n ${this.isTruncated?"":i`<slot name="truncated"></slot>`}\n </section>\n `}renderExpandButton(){return this.isTruncated?this.renderTruncatedExpandButton():""}render(){return i`\n ${this.renderContent()}\n <faceplate-dialog \n ${L(this.overflowActionsMenuRef)}\n class="overflow-actions-dialog" \n @click="${this.handleCloseOverflowActionsMenu}" \n>\n <faceplate-screen-reader-content id="overflow-actions-menu-label">\n Additional comment actions\n </faceplate-screen-reader-content>\n <ul class="overflow-actions-menu" aria-labelledby="overflow-actions-menu-label">\n <li>\n <a href="${this.permalink}">\n <icon-link-post aria-hidden="true" class="overflow-actions-icon"></icon-link-post>\n Share\n </a>\n </li>\n ${this.isProfilePost?"":i`\n <li>\n <a href="/${this.subredditPrefixedName}/">\n <icon-admin aria-hidden="true" class="overflow-actions-icon"></icon-admin>\n More from ${this.subredditPrefixedName}\n </a>\n </li>\n `}\n ${this.isAuthorDeleted?"":i`<li>\n <a href="/user/${this.author}/">\n <icon-user aria-hidden="true" class="overflow-actions-icon"></icon-user> ${this.author}'s profile\n </a>\n </li>`}\n ${this.isReportingEnabled?i`<li>\n <shreddit-overflow-report \n thingId="${this.thingId}" \n type="${ct.COMMENT}" \n></shreddit-overflow-report>\n </li>`:""}\n <button \n class="button button-small button-plain block bg-tone-6 text-tone-3 mt-[10px] mx-auto mb-0 w-[calc(100%-20px)] max-w-full" \n>\n Close\n </button>\n </ul>\n </faceplate-dialog>\n ${this.renderExpandButton()}\n `}handleOpenOverflowActionsMenu({detail:{author:t,isAuthorDeleted:e,permalink:s,thingId:n}}){this.author=t,this.isAuthorDeleted=e,this.permalink=s,this.thingId=n,this.overflowActionsMenuRef.value?.showModal(),document.documentElement.addEventListener("click",this.handleCloseOverflowActionsMenu),this.scrollBlocker.blockPageScrolling()}};t([s({type:String})],Tt.prototype,"thingId",void 0),t([s({type:String,attribute:"post-id"})],Tt.prototype,"postId",void 0),t([s({type:String,attribute:"subreddit-prefixed-name"})],Tt.prototype,"subredditPrefixedName",void 0),t([s({type:Boolean})],Tt.prototype,"isTruncated",void 0),t([s({type:Number})],Tt.prototype,"totalComments",void 0),t([s({type:Boolean})],Tt.prototype,"isProfilePost",void 0),t([s({type:Boolean,attribute:"is-reporting-enabled"})],Tt.prototype,"isReportingEnabled",void 0),t([s({type:String,attribute:"ui"})],Tt.prototype,"ui",void 0),t([o()],Tt.prototype,"permalink",void 0),t([o()],Tt.prototype,"author",void 0),t([o()],Tt.prototype,"isAuthorDeleted",void 0),Tt=t([n("shreddit-comment-tree")],Tt);let xt=class extends e{constructor(){super(),this.postId="",this.handleCommentCreated=({postId:t})=>{t===this.postId&&this.remove()},this.pubsub=new D(this)}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(g.CommentCreated,this.handleCommentCreated)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(g.CommentCreated,this.handleCommentCreated)}render(){return i`<slot></slot>`}};xt.styles=[l`:host{display:contents}`,C],t([s({type:String,attribute:"post-id"})],xt.prototype,"postId",void 0),xt=t([n("comment-forest-empty-state")],xt);let jt=class extends ht{constructor(){super(...arguments),this.mtSeoLanguage="",this.isSeoVisit=!1,this.isLoadingTranslations=!1,this._partialRequestController=new V(this),this.seoVisitSettled=!1,this.pubsub=new D(this),this.onPostTranslationOverride=t=>{"PDP"===t.pageType&&(t.isTranslationActive?this.onTranslationsEnabled():this.onTranslationsDisabled())},this.onCommentTranslationOverride=t=>{this.onCommentTranslationToggle(t.id,t.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(g.I18nPostTranslationOverride,this.onPostTranslationOverride,!1),this.pubsub.subscribe(g.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.addEventListener(M,this.handleTranslationFeedback)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(g.I18nPostTranslationOverride,this.onPostTranslationOverride),this.pubsub.unsubscribe(g.I18nCommentTranslationOverride,this.onCommentTranslationOverride)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}async onCommentTranslationToggle(t,e){const s=this.getCommentMetadataById(t);if(!s||!s.isTranslatable)return;const n=this.objectTranslationCache.get(t);if(!(e?!!n?.translatedElement:!!n?.originalElement)){const s=await this.fetchComments([t],e?"translated":"original");this.storeCommentTranslationCache(s)}this.renderTranslationCache(e,t)}async onTranslationsEnabled(){const t=await this.runTranslations(!0);$(!0),q(!0,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async onTranslationsDisabled(){const t=await this.runTranslations(!1);$(!1),q(!1,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async runTranslations(t){const e=t??!!this.translationContextValue.isTranslationActive,s=this.getCommentsMetadata();this.storeCommentTranslationCache(s.map((t=>({id:t.id,translation:t.isTranslated?t.slot.innerHTML:void 0,original:t.isTranslated?void 0:t.slot.innerHTML}))));const n=[];this.objectTranslationCache.forEach(((t,s)=>{(e&&!t.translatedElement||!e&&!t.originalElement)&&n.push(s)}));let i=[];return n.length&&(i=await this.fetchComments(n,e?"translated":"original"),this.storeCommentTranslationCache(i||[])),this.renderTranslationCache(e),{fetchedComments:i}}getCommentMetadataById(t){const e=this.querySelector(`shreddit-comment[thingid="${t}"]`);if(e)return this.getCommentMetadata(e)}getCommentsMetadata(){const t=this.querySelectorAll("shreddit-comment");return Array.from(t).filter((t=>{const e=t.getAttribute("thingid"),s=null!==t.getAttribute("is-translatable"),n=t.querySelector('div[slot="comment"]');return!!e&&s&&!!n})).map((t=>this.getCommentMetadata(t)))}getCommentMetadata(t){return{id:t.getAttribute("thingid"),isTranslated:null!==t.getAttribute("is-comment-translated"),isTranslatable:null!==t.getAttribute("is-translatable"),element:t,slot:t.querySelector('div[slot="comment"]'),cache:this.objectTranslationCache.get(t.getAttribute("thingid"))}}async fetchComments(t,e){const s=new FormData;t.forEach((t=>s.append("commentIds[]",t))),s.append("includeTranslation","translated"===e?"true":"false");const n=await this.fetchRequestPartial("/svc/shreddit/translated-comment/",{method:B.Post,body:s});return n?this.parseFetchCommentResponse(n):[]}parseFetchCommentResponse(t){return t.map((t=>{const e=t.getAttribute("data-comment-id"),s=t.querySelector(`[data-translated-comment-id="${e}"]`)?.querySelector(`#${e}-translated-post-rtjson-content`),n=t.querySelector(`[data-original-comment-id="${e}"]`)?.querySelector(`#${e}-post-rtjson-content`),i=t=>t?`<div class="py-0 xs:mx-xs mx-2xs inline-block">${t}</div>`:void 0;return{id:e,original:i(n?.innerHTML),translation:i(s?.innerHTML)}}))}storeCommentTranslationCache(t){t.forEach((t=>{this.updateTranslationCache(t.id,{originalElement:t.original?{content:t.original}:void 0,translatedElement:t.translation?{content:t.translation}:void 0})}))}renderTranslationCache(t,e){const s=t??!!this.translationContextValue.isTranslationActive;(e?[this.getCommentMetadataById(e)]:this.getCommentsMetadata()).filter((t=>t&&t.isTranslated!==s&&(s?!!t.cache?.translatedElement:!!t.cache?.originalElement))).forEach((t=>{const e=s?t.cache.translatedElement:t.cache.originalElement;t.slot.innerHTML=e?.content||"",s?t.element.setAttribute("is-comment-translated","true"):t.element.removeAttribute("is-comment-translated")}))}handleTranslationFeedback(t){const{postId:e,commentId:s}=t.detail,n=document.querySelector("shreddit-post"),i=n?.querySelector('[slot="title"]'),o=n?.querySelector('[slot="text-body"]'),a=this.shadowRoot?.getElementById(U.ID.PDP_COMMENT_FEEDBACK_MODAL);a&&a.show?.({post:{id:pt(e),title:i?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:this.translationContextValue.isTranslationActive},comment:{id:s,post_id:pt(e),translation_state:this.translationContextValue.isTranslationActive}})}toggleObserverForComments(t){t?.forEach((t=>{const e=document.querySelector(`shreddit-comment[thingid="${t.id}"]`);e&&e?.addTranslationToggledObserver?.('div[slot="comment"]')}))}submitTranslationMetrics(){if(!this.reportMetrics)return;const t=this.querySelectorAll("shreddit-comment"),e=this.translationContextValue?.isTranslationActive||!1,s={},n=[];t.length&&Array.from(t).filter((t=>{const s=this.getCommentMetadata(t);if(!t)return;const i=s.slot.textContent||"",o=s.cache;let a=e?"":i,r=e?i:"";o&&(a=o.originalElement?.content||a,r=o.translatedElement?.content||r),n.push({id:s.id,originalBody:a,translatedBody:r,isTranslated:s.isTranslated,isTranslatable:s.isTranslatable})})),s.scenario=this.metricsScenario,s.comments=R(e,n),this.dispatchEvent(F(N,s))}render(){return i`\n <div><slot></slot></div>\n <translation-feedback-modal \n id="${U.ID.PDP_COMMENT_FEEDBACK_MODAL}" \n></translation-feedback-modal>\n `}};t([s({type:String,attribute:"mt-seo-language"})],jt.prototype,"mtSeoLanguage",void 0),t([s({type:Boolean,attribute:"is-seo-visit"})],jt.prototype,"isSeoVisit",void 0),jt=t([n("comment-translator")],jt);let At=class extends e{constructor(){super(),this.target="",this.path="",this.replaceComments=async({sort:t="",filter:e=""})=>{t!==this.getCurrentSort()&&this.updateLocation({sort:t});const s=new URL(`${location.origin}${this.path}`);t&&s.searchParams.set("sort",t.toLowerCase()),e&&s.searchParams.set("filter",e.toLowerCase()),s.searchParams.set("inline-refresh","true");const n=s.toString().substring(location.origin.length);this.replaceContentController.loadAndReplaceContent({src:n,target:this.target,afterSuccess:()=>z(this,{message:"The comments are sorted successfully",options:{priority:H.assertive}}),afterFailure:()=>this.dispatchEvent(F("faceplate-alert",{level:Q.error,message:"Failed to load the comments."}))})},this.handleCommentFilterUpdated=({sort:t,filter:e})=>{this.replaceComments({filter:e??this.getCurrentFilter(),sort:t??this.getCurrentSort()})},this.handleSortEvent=async t=>{this.replaceComments({sort:t.detail.selected?.toLowerCase(),filter:this.getCurrentFilter()}),this.pubsub.publish(g.CommentSort,{sort:t.detail.selected})},this.handleClickEvent=async t=>{const e=t.target?.getAttribute("value");e&&(this.replaceComments({filter:e,sort:this.getCurrentSort()}),t.preventDefault())},this.replaceContentController=new ut,this.pubsub=new D(this)}updateLocation({sort:t}){const e=new URL(location.href);e.searchParams.set("sort",t.toLowerCase()),history.replaceState({},"",e.toString())}getCurrentFilter(){return this.querySelector("[faceplate-tab-selected]")?.getAttribute("value")?.toLowerCase()||""}getCurrentSort(){return new URLSearchParams(location.search).get("sort")||""}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(g.CommentFilterUpdated,this.handleCommentFilterUpdated),this.querySelector("shreddit-sort-dropdown")?.addEventListener("comment-sort",this.handleSortEvent),this.querySelector("faceplate-tabgroup")?.addEventListener("click",this.handleClickEvent)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(g.CommentFilterUpdated,this.handleCommentFilterUpdated),this.querySelector("shreddit-sort-dropdown")?.removeEventListener("comment-sort",this.handleSortEvent),this.querySelector("faceplate-tabgroup")?.removeEventListener("click",this.handleClickEvent)}render(){return i`<slot></slot>`}};t([s({type:String})],At.prototype,"target",void 0),t([s({type:String})],At.prototype,"path",void 0),At=t([n("shreddit-comments-sort-dropdown")],At);let It=class extends e{constructor(){super(...arguments),this.target="",this.path="",this.showOnLoad=!1,this.initialValue="",this.commentComposerSelector=J.commentComposerHost,this.addCommentButton=J.addCommentButton,this.pdpCommentsSortSelector=J.pdpCommentsTreeSortContainer,this.pdpAmaCommentTabSelector=J.pdpAmaCommentTabWrapper,this.shredditCommentsSortSelector=J.shredditCommentsSortDropdown,this.open=this.showOnLoad,this.commentSearchActive=this.showOnLoad,this.focusSearchInput=()=>{this.open||(this.open=!0),this.searchInput?.innerInput?.focus()},this.resetSearchInput=()=>{this.handleClear(),this.open=!1,gt.update(K.PdpCommentSearch),this.commentSearchActive=!1,this.expandSearchButton?.focus()},this.replaceContentController=new ut,this.handlePdpCommentSearch=W((async()=>{const t=this.searchInput?.value??"";if(t){this.commentSearchActive=!0;const e={conversationId:Ct.get(K.PdpCommentSearch),impressionId:gt.getUUID(),query:t,scope:{type:G.PDP,path:this.path},cursor:{},type:Z.Comments};this.addSearchParamsToUrl(e);const s=new URLSearchParams({...bt(e)});X(this,_({source:"search",action:"click",noun:"full_search_button"},this.searchTelemetryData));const n=document.createElement("span");n.id=this.target,this.replaceContentController.loadAndReplaceContent({src:`/svc/shreddit${this.path}pdp-comment-search-results?${s.toString()}`,target:this.target,wrapPartialElement:t=>(n.appendChild(t),n)})}}),300),this.handleKeyDown=t=>{gt.update(K.PdpCommentSearch),"Enter"===t.key&&t.target===this.searchInput&&this.handlePdpCommentSearch(),"Escape"===t.key&&t.target===this.searchInput&&(t.stopPropagation(),this.commentSearchActive?this.searchInput?.blur():this.resetSearchInput())},this.handleClear=()=>{this.searchInput?.value&&(this.searchInput.value="")}}hideElementsVisibility(t){document.querySelector(this.commentComposerSelector)?.classList.toggle("hidden",t),document.querySelector(this.addCommentButton)?.classList.toggle("hidden",t),document.querySelector(this.pdpCommentsSortSelector)?.classList.toggle("hidden",t),document.querySelector(this.pdpAmaCommentTabSelector)?.classList.toggle("hidden",t),document.querySelector(this.shredditCommentsSortSelector)?.classList.toggle("flex",!t)}connectedCallback(){super.connectedCallback(),this.commentSearchActive=this.showOnLoad,this.open=this.showOnLoad,this.hideElementsVisibility(this.showOnLoad)}get searchTelemetryData(){const t=this.searchInput?.value??"";return{action_info:{page_type:Y.PostDetail},search:{conversation_id:Ct.get(K.PdpCommentSearch),impression_id:gt.get(K.PdpCommentSearch),query:t,query_id:ft.get({query:t,scope:{type:G.PDP,path:this.path},type:Z.Comments},K.PdpCommentSearch),origin_element:tt.CommentSearchBar,origin_page_type:Y.PostDetail}}}addSearchParamsToUrl(t){const e=location.href,s=new URL(e);s.searchParams.set(vt.Query,t.query),s.searchParams.set(vt.Type,t.type),s.searchParams.set(vt.ConversationId,t.conversationId??Ct.get(K.PdpCommentSearch)),s.searchParams.set(vt.ImpressionId,t.impressionId??gt.getUUID());const n=s.toString();n!==e&&history.replaceState({},"",n)}updated(t){if(t.has("open")){const e=!t.get("open")&&this.open,s=t.get("open")&&!this.open;e?this.focusSearchInput():s&&this.expandSearchButton?.focus()}this.hideElementsVisibility(this.commentSearchActive||this.open)}render(){const t="Search Comments";return i`<div \n class="block ml-xs" \n data-faceplate-tracking-context="${JSON.stringify(this.searchTelemetryData)}" \n>\n <faceplate-tracker source="search" action="click" noun="search_bar">\n ${P({appearance:"bordered",attributes:{"aria-controls":"pdp-comment-search-form","aria-expanded":`${this.open}`,className:"border-neutral-border-weak hover:border-neutral-content-weak text-secondary-weak font-normal "+(this.open?"hidden":""),id:"expand-pdp-comment-search-button",onclick:this.focusSearchInput,type:"button"},children:i`<span class="flex pr-xs">${t}</span>`,leadingIcon:i`<span class="flex pl-xs" \n>${d({size:r.Small})}</span>`,screenReaderContent:"Expand comment search"})}\n </faceplate-tracker>\n <form \n class="flex w-full ${et({hidden:!this.open})}" \n id="pdp-comment-search-form" \n @submit="${this.handlePdpCommentSearch}" \n>\n <faceplate-search-input \n class="text-secondary-plain m-0 rounded-full outline outline-1 outline-neutral-border-weak flex-grow focus:outline-neutral-content-weak" \n placeholder="${t}" \n @keydown="${this.handleKeyDown}" \n @focus="${()=>{this.open=!0}}" \n value="${this.initialValue}" \n>\n ${P({attributes:{id:"search-input-clear-button",slot:"clearIcon",type:"button",onclick:this.handleClear},appearance:"plain",size:O.Small,screenReaderContent:"Clear search",leadingIcon:m({size:r.Small})})}</faceplate-search-input>\n ${P({appearance:"plain",attributes:{className:"ml-xs"+(this.commentSearchActive?" hidden":""),id:"cancel-pdp-comment-search-button",onclick:this.resetSearchInput,type:"button"},children:"Cancel"})}\n </form>\n </div>`}};It.styles=[C],t([s({type:String})],It.prototype,"target",void 0),t([s({type:String})],It.prototype,"path",void 0),t([s({attribute:"show-on-load",type:Boolean})],It.prototype,"showOnLoad",void 0),t([s({type:String,attribute:"initial-value"})],It.prototype,"initialValue",void 0),t([s({type:String,attribute:"comment-composer-selector"})],It.prototype,"commentComposerSelector",void 0),t([s({type:String,attribute:"add-comment-button"})],It.prototype,"addCommentButton",void 0),t([s({type:String,attribute:"pdp-comments-sort-selector"})],It.prototype,"pdpCommentsSortSelector",void 0),t([s({type:String,attribute:"pdp-ama-comments-tab-selector"})],It.prototype,"pdpAmaCommentTabSelector",void 0),t([s({type:String,attribute:"shreddit-comments-sort-dropdown-selector"})],It.prototype,"shredditCommentsSortSelector",void 0),t([c("#expand-pdp-comment-search-button")],It.prototype,"expandSearchButton",void 0),t([c("faceplate-search-input")],It.prototype,"searchInput",void 0),t([o()],It.prototype,"open",void 0),t([o()],It.prototype,"commentSearchActive",void 0),It=t([n("pdp-comment-search-input")],It);let Et=class extends e{constructor(){super(...arguments),this.commentId="",this.dedupe=!1,this.pubsub=new D(this),this.loadInAd=()=>{if(!this.shadowRoot||this.shadowRoot.childNodes.length>0)return;const t=document.querySelector(`shreddit-comment-tree-ads > template#comment-tree-ad_${this.commentId}`),e=t?.content.querySelector("shreddit-comments-page-ad");t&&e&&this.isNotADuplicate(e)&&(this.shadowRoot.replaceChildren(t.content.cloneNode(!0)),e.hasAttribute("is-blank")||this.removeAttribute("class"))},this.isNotADuplicate=t=>{if(!this.dedupe||t.hasAttribute("is-blank"))return!0;const e=document.querySelector("shreddit-comments-page-ad");return!e||t.getAttribute("campaign-id")!==e.getAttribute("campaign-id")}}connectedCallback(){super.connectedCallback(),this.commentId&&(this.loadInAd(),this.pubsub.subscribe(g.CommentTreeAdsLoaded,this.loadInAd))}disconnectedCallback(){this.commentId&&this.pubsub.unsubscribe(g.CommentTreeAdsLoaded,this.loadInAd),super.disconnectedCallback()}render(){return h}};Et.styles=[C],t([s({type:String,attribute:"comment-id"})],Et.prototype,"commentId",void 0),t([s({type:Boolean,attribute:"dedupe"})],Et.prototype,"dedupe",void 0),Et=t([n("shreddit-comment-tree-ad")],Et);let Pt=class extends e{constructor(){super(...arguments),this.translationContextValue=nt,this.pubsub=new D(this),this.onPostTranslationOverride=t=>{t.id===this.postId&&(this.postTranslationOverrideActive=t.isTranslationActive,this.commentTranslationOverrideActive=void 0)},this.onCommentTranslationOverride=t=>{t.id===this.commentId&&(this.commentTranslationOverrideActive=t.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(g.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.pubsub.subscribe(g.I18nPostTranslationOverride,this.onPostTranslationOverride,!1)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(g.I18nCommentTranslationOverride,this.onCommentTranslationOverride),this.pubsub.unsubscribe(g.I18nPostTranslationOverride,this.onPostTranslationOverride)}render(){const t=this.translationContextValue.isTranslationActive,e=this.postTranslationOverrideActive,s=this.commentTranslationOverrideActive,n="boolean"==typeof e?"boolean"==typeof s&&s!==e:"boolean"==typeof s&&s!==t,o=!!n&&!s;return n?i`<div \n class="flex items-center text-neutral-content-weak" \n data-testid="comment-translation-status-icon" \n>\n ${!!n&&s?p({size:r.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-translated-icon","aria-label":"Comment is translated"}}):h}\n ${o?u({size:r.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-original-icon","aria-label":"Comment is in original language",className:o?"":"hidden"}}):h}\n </div>`:h}};Pt.styles=[C],t([st({context:it,subscribe:!0}),o()],Pt.prototype,"translationContextValue",void 0),t([o()],Pt.prototype,"commentTranslationOverrideActive",void 0),t([o()],Pt.prototype,"postTranslationOverrideActive",void 0),t([s({type:String,attribute:"comment-id"})],Pt.prototype,"commentId",void 0),t([s({type:String,attribute:"post-id"})],Pt.prototype,"postId",void 0),Pt=t([n("comment-translation-status-icon")],Pt);
//# sourceMappingURL=comment-forest-client-js-3c05e30c.js.map
